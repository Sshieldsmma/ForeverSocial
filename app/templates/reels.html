{% extends "layout.html" %}
{% block content %}
<div class="container mt-4 reels-feed">

  <!-- Upload Form -->
  <form action="{{ url_for('reels.upload_reel') }}" method="post" enctype="multipart/form-data" id="reelUploadForm">
    <input type="hidden" name="user_id" value="{{ current_user.id }}">

    <div class="mb-2">
      <button type="button" class="btn btn-outline-primary w-100" onclick="document.getElementById('videoInput').click();">
        üé• Upload a Reel
      </button>
      <input type="file" id="videoInput" name="video" accept="video/*" class="d-none">
      <div id="fileName" class="form-text mt-1 text-center">No file chosen</div>
    </div>

    <div id="captionInput" class="mb-2 d-none">
      <input type="text" name="caption" placeholder="Write a caption..." class="form-control">
    </div>

    <button type="submit" class="btn btn-primary w-100 mt-2" id="postButton" disabled>‚¨ÜÔ∏è Post it Forever</button>
    <script>
      const postButton = document.getElementById('postButton');
      videoInput.addEventListener('change', function () {
      postButton.disabled = !videoInput.files.length;
      });
    </script>
  </form>

  <hr class="my-4">

  <!-- Reels Feed -->
  {% for reel in reels %}
  <div class="reel mb-4">
    <video controls class="w-100 mb-2" style="max-height: 400px;">
      <source src="{{ reel.video_url }}" type="video/mp4">
    </video>
    <p><strong>Caption:</strong> {{ reel.caption }}</p>

    <!-- Like Button -->
    <form action="{{ url_for('reels.like_reel', reel_id=reel.id) }}" method="post" class="d-inline">
      <button class="btn btn-sm btn-outline-danger">‚ù§Ô∏è {{ reel.likes }}</button>
    </form>

    <!-- Comment Form -->
    <form action="{{ url_for('reels.comment_reel', reel_id=reel.id) }}" method="post" class="d-inline w-100 mt-2">
      <div class="input-group">
        <input type="text" name="comment" placeholder="Add comment" class="form-control">
        <button class="btn btn-outline-secondary" type="submit">Comment</button>
      </div>
    </form>
  </div>
  {% endfor %}
</div>

<!-- JS for interactivity -->
<script>
  const videoInput = document.getElementById('videoInput');
  const fileNameDisplay = document.getElementById('fileName');
  const captionInput = document.getElementById('captionInput');

  videoInput.addEventListener('change', function () {
    const file = videoInput.files[0];
    if (file) {
      fileNameDisplay.textContent = file.name;
      captionInput.classList.remove('d-none');
    } else {
      fileNameDisplay.textContent = 'No file chosen';
      captionInput.classList.add('d-none');
    }
  });
</script>
{% endblock %}

